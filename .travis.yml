sudo: false
cache: yarn
language: node_js

env:
  global:
  - NODE_ENV='test'
  - DOCKER_USERNAME='xxxxxxxxxxxxxxxxxxxx'
  - DOCKER_PASSWORD='xxxxxxxxxxxxxxxxxxxxxxxxxx'

before_install:
- cd ./$SERVICE
- nvm install
- nvm use
- npm install --only=production

before_script:
- SERVICE=$SERVICE make ensure-dependencies
- sleep 10

script:
- make brand
- make package
- make qa

matrix:
  include:
  - env: SERVICE=recipes-api
    services:
    - docker
  - env: SERVICE=recipes-crawler
    services:
    - docker
  - env: SERVICE=recipes-id-generator
    services:
    - docker
